<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>custom emoji shortcodes in 11ty with a plugin</title>
    <meta name="description" content="custom emoji shortcodes!">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="some cat blog">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="me" href="https://toot.cat/@somecat">
    <link rel="stylesheet" href="/scss/main.css">
    
      
        
      
      
    
    
    <meta property="og:image" content="/og-images/541974bb.png">
    
    <script type="module">
      // Thank you to https://github.com/daviddarnes/heading-anchors
// Thank you to https://amberwilson.co.uk/blog/are-your-anchor-links-accessible/

let globalInstanceIndex = 0;

class HeadingAnchors extends HTMLElement {
	static register(tagName) {
		if ("customElements" in window) {
			customElements.define(tagName || "heading-anchors", HeadingAnchors);
		}
	}

	static attributes = {
		exclude: "data-ha-exclude",
		prefix: "prefix",
		content: "content",
	}

	static classes = {
		anchor: "ha",
		placeholder: "ha-placeholder",
		srOnly: "ha-visualhide",
	}

	static defaultSelector = "h2,h3,h4,h5,h6";

	static css = `
.${HeadingAnchors.classes.srOnly} {
	clip: rect(0 0 0 0);
	height: 1px;
	overflow: hidden;
	position: absolute;
	width: 1px;
}
.${HeadingAnchors.classes.anchor} {
	position: absolute;
	left: var(--ha_offsetx);
	top: var(--ha_offsety);
	text-decoration: none;
	opacity: 0;
}
.${HeadingAnchors.classes.placeholder} {
	opacity: .3;
}
.${HeadingAnchors.classes.anchor}:is(:focus-within, :hover) {
	opacity: 1;
}
.${HeadingAnchors.classes.anchor},
.${HeadingAnchors.classes.placeholder} {
	display: inline-block;
	padding: 0 .25em;

	/* Disable selection of visually hidden label */
	-webkit-user-select: none;
	user-select: none;
}

@supports (anchor-name: none) {
	.${HeadingAnchors.classes.anchor} {
		position: absolute;
		left: anchor(left);
		top: anchor(top);
	}
}`;

	get supports() {
		return "replaceSync" in CSSStyleSheet.prototype;
	}

	get supportsAnchorPosition() {
		return CSS.supports("anchor-name: none");
	}

	constructor() {
		super();

		if(!this.supports) {
			return;
		}

		let sheet = new CSSStyleSheet();
		sheet.replaceSync(HeadingAnchors.css);
		document.adoptedStyleSheets = [...document.adoptedStyleSheets, sheet];

		this.headingStyles = {};
		this.instanceIndex = globalInstanceIndex++;
	}

	connectedCallback() {
		if (!this.supports) {
			return;
		}

		this.headings.forEach((heading, index) => {
			if(!heading.hasAttribute(HeadingAnchors.attributes.exclude)) {
				let anchor = this.getAnchorElement(heading);
				let placeholder = this.getPlaceholderElement();

				// Prefers anchor position approach for better accessibility
				// https://amberwilson.co.uk/blog/are-your-anchor-links-accessible/
				if(this.supportsAnchorPosition) {
					let anchorName = `--ha_${this.instanceIndex}_${index}`;
					placeholder.style.setProperty("anchor-name", anchorName);
					anchor.style.positionAnchor = anchorName;
				}

				heading.appendChild(placeholder);
				heading.after(anchor);
			}
		});
	}

	// Polyfill-only
	positionAnchorFromPlaceholder(placeholder) {
		if(!placeholder) {
			return;
		}

		let heading = placeholder.closest("h1,h2,h3,h4,h5,h6");
		if(!heading.nextElementSibling) {
			return;
		}

		// TODO next element could be more defensive
		this.positionAnchor(heading.nextElementSibling);
	}

	// Polyfill-only
	positionAnchor(anchor) {
		if(!anchor || !anchor.previousElementSibling) {
			return;
		}

		// TODO previous element could be more defensive
		let heading = anchor.previousElementSibling;
		this.setFontProp(heading, anchor);

		if(this.supportsAnchorPosition) {
			// quit early
			return;
		}

		let placeholder = heading.querySelector(`.${HeadingAnchors.classes.placeholder}`);
		if(placeholder) {
			anchor.style.setProperty("--ha_offsetx", `${placeholder.offsetLeft}px`);
			anchor.style.setProperty("--ha_offsety", `${placeholder.offsetTop}px`);
		}
	}

	setFontProp(heading, anchor) {
		let placeholder = heading.querySelector(`.${HeadingAnchors.classes.placeholder}`);
		if(placeholder) {
			let style = getComputedStyle(placeholder);
			let props = ["font-weight", "font-size", "line-height", "font-family"];
			let font = props.map(name => style.getPropertyValue(name));
			anchor.style.setProperty("font", `${font[0]} ${font[1]}/${font[2]} ${font[3]}`);
		}
	}

	getAccessibleTextPrefix() {
		// Useful for i18n
		return this.getAttribute(HeadingAnchors.attributes.prefix) || "Jump to section titled";
	}

	getContent() {
		if(this.hasAttribute(HeadingAnchors.attributes.content)) {
			return this.getAttribute(HeadingAnchors.attributes.content);
		}
		return "#";
	}

	// Placeholder nests inside of heading
	getPlaceholderElement() {
		let ph = document.createElement("span");
		ph.setAttribute("aria-hidden", true);
		ph.classList.add(HeadingAnchors.classes.placeholder);
		let content = this.getContent();
		if(content) {
			ph.textContent = content;
		}

		ph.addEventListener("mouseover", (e) => {
			let placeholder = e.target.closest(`.${HeadingAnchors.classes.placeholder}`);
			if(placeholder) {
				this.positionAnchorFromPlaceholder(placeholder);
			}
		});

		return ph;
	}

	getAnchorElement(heading) {
		let anchor = document.createElement("a");
		anchor.href = `#${heading.id}`;
		anchor.classList.add(HeadingAnchors.classes.anchor);

		let content = this.getContent();
		anchor.innerHTML = `<span class="${HeadingAnchors.classes.srOnly}">${this.getAccessibleTextPrefix()}: ${heading.textContent}</span>${content ? `<span aria-hidden="true">${content}</span>` : ""}`;

		anchor.addEventListener("focus", e => {
			let anchor = e.target.closest(`.${HeadingAnchors.classes.anchor}`);
			if(anchor) {
				this.positionAnchor(anchor);
			}
		});

		anchor.addEventListener("mouseover", (e) => {
			// when CSS anchor positioning is supported, this is only used to set the font
			let anchor = e.target.closest(`.${HeadingAnchors.classes.anchor}`);
			this.positionAnchor(anchor);
		});

		return anchor;
	}

	get headings() {
		return this.querySelectorAll(this.selector.split(",").map(entry => `${entry.trim()}[id]`));
	}

	get selector() {
		return this.getAttribute("selector") || HeadingAnchors.defaultSelector;
	}
}

HeadingAnchors.register();

export { HeadingAnchors }

    </script>
    
    <link rel="stylesheet" href="/assets/photoswipe/photoswipe.css">
  </head>
  <body>
    <a href="#skip" class="visually-hidden">Skip to main content</a>
    <header>
      
      <nav id="menu">
        <h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
        <div class="menu-inner">
          <input type="checkbox" id="menu-toggle" hidden="">
          <label for="menu-toggle" class="menu-icon">☰</label>
          <div class="menu-left"></div>
          <ul class="nav-links">
              <li>
                <a href="/">home</a>
              </li>
            
              <li>
                <a href="/blog/">archive</a>
              </li>
            
              <li>
                <a href="/tags/">tags</a>
              </li>
            
              <li>
                <a href="/about/">about</a>
              </li>
            
              <li>
                <a href="/feed/feed.xml">feed</a>
              </li>
            
          </ul>
          <div class="menu-right">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun-icon lucide-sun">
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2"></path>
              <path d="M12 20v2"></path>
              <path d="m4.93 4.93 1.41 1.41"></path>
              <path d="m17.66 17.66 1.41 1.41"></path>
              <path d="M2 12h2"></path>
              <path d="M20 12h2"></path>
              <path d="m6.34 17.66-1.41 1.41"></path>
              <path d="m19.07 4.93-1.41 1.41"></path>
            </svg>
            <input type="checkbox" id="theme-toggle-checkbox" onclick="toggleTheme()">
            <label for="theme-toggle-checkbox" id="theme-toggle-label"></label>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon-icon lucide-moon">
              <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
            </svg>
          </div>
        </div>
      </nav>
    </header>
    <script>
			(function() {
				const storedTheme = localStorage.getItem('theme');
				const isDark = storedTheme ? storedTheme === "dark"	: window.matchMedia('(prefers-color-scheme: dark)').matches;
				document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
				const themeCheckbox = document.getElementById('theme-toggle-checkbox');
				if (themeCheckbox) {
				themeCheckbox.checked = isDark;
				}
			})();
    </script>
    <main id="skip">
      <heading-anchors>
      
<h1 id="custom-emoji-shortcodes-in-11ty-with-a-plugin">custom emoji shortcodes in 11ty with a plugin</h1>
<dl class="post-metadata">
  <dt>posted:</dt>
  <dd>
    <time datetime="2025-05-18" aria-label="Published on 18 May 2025">2025.05.18</time>
  </dd>
  
    <dt>modified:</dt>
    <dd>
      <time datetime="2025-05-23" aria-label="Updated on 23 May 2025">2025.05.23</time>
    </dd>
  
  <dt>tags:</dt>
  <dd>
    <ul class="tags-list">
        <li>
          <a href="/tags/11ty/
        " class="post-tag">11ty</a>
        </li>
        <li>
          <a href="/tags/blog/
        " class="post-tag">blog</a>
        </li>
        <li>
          <a href="/tags/markdown/
        " class="post-tag">markdown</a>
        </li>
        <li>
          <a href="/tags/obsidian/
        " class="post-tag">obsidian</a>
        </li>
        <li>
          <a href="/tags/plugin/
        " class="post-tag">plugin</a>
        </li>
        <li>
          <a href="/tags/emoji/
        " class="post-tag">emoji</a>
        </li>
    </ul>
  </dd>
</dl>
<article class="post-content">
  <nav class="table-of-contents">
    
  </nav>
  <div class="photoswipe-gallery"><p>hey <span class="custom-emoji--span"><img src="/img/emoji/neocat/neocat_peek.png" alt="emoji: neocat_peek" class="custom-emoji--img"></span> i did a thing</p>
<p>it's a plugin for <a href="https://11ty.dev" class="external-link" target="_blank" rel="noopener noreferrer" aria-label="External link (opens in new tab)">11ty</a>, as a helper module for <a href="https://github.com/markdown-it/markdown-it-emoji" class="external-link" target="_blank" rel="noopener noreferrer" aria-label="External link (opens in new tab)">markdown-it-emoji</a>, so it's possible to easily have <strong>custom emoji/icon shortcodes</strong>! <span class="custom-emoji--span"><img src="/img/emoji/neocat/neocat_3c.png" alt="emoji: neocat_3c" class="custom-emoji--img"></span></p>
<p>it:</p>
<ul>
<li>takes in your <code class="language-text">md</code> library from 11ty</li>
<li>scans a dir for custom emoji images</li>
<li>makes the definitions (the shortcodes and info about what image the shortcode refers to)</li>
<li>optionally also converts shortcodes for standard unicode emoji to their unicode equivalent</li>
<li>makes an <code class="language-text">&lt;img&gt;</code> with custom attributes for the custom emoji, wrapped in a <code class="language-text">&lt;span&gt;</code> with a custom class (specific to these custom emoji image spans)</li>
<li>wraps the unicode emoji that were converted from shortcode (if any) in a <code class="language-text">&lt;span&gt;</code> with a custom class name (specific to these unicode emoji spans)</li>
<li>also includes some (optional) basic <code class="language-text">css</code> snippet to try to make the custom emoji and unicode emoji a bit more uniform in appearance (at least on my site, on my device lol)</li>
<li>returns the modified <code class="language-text">md</code> library</li>
</ul>
<p>so when the site is built, if you have some markdown like:<br>
<code class="language-text">:cat: :arrow_left: *unicode!*</code><br>
<code class="language-text">:neocat: *custom!*</code><br>
you'll get something like:</p>
<p><span class="unicode-emoji--span">🐱</span> <span class="unicode-emoji--span">⬅️</span> <em>unicode!</em><br>
<span class="custom-emoji--span"><img src="/img/emoji/neocat.png" alt="emoji: neocat" class="custom-emoji--img"></span> <em>custom!</em></p>

<div class="callout" data-callout="heart">
<div class="callout-title">
<div class="callout-title-icon">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart-icon lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg>
</div>
<div class="callout-title-inner">Heart</div>
</div>
<div class="callout-content"><p><strong>much thanks and shoutout and meowing to <a href="https://volpeon.ink" class="external-link" target="_blank" rel="noopener noreferrer" aria-label="External link (opens in new tab)">volpeon</a> for making <a href="https://volpeon.ink/emojis/" class="external-link" target="_blank" rel="noopener noreferrer" aria-label="External link (opens in new tab)">custom emoji sets</a> that are so good i was compelled to create this plugin to use them here!</strong> <span class="custom-emoji--span"><img src="/img/emoji/neocat/neocat_heart.png" alt="emoji: neocat_heart" class="custom-emoji--img"></span><br>
(neocat emoji license: <a href="https://spdx.org/licenses/CC-BY-NC-SA-4.0.html" class="external-link" target="_blank" rel="noopener noreferrer" aria-label="External link (opens in new tab)">CC-BY-NC-SA-4.0</a>)</p>
</div></div></div>
</article>
    <ul class="links-nextprev">
        <li class="links-nextprev-prev">
          ← previous
          <br>
          <a href="/blog/2025-05-05 - blog - obsidian templates and use/">blog - obsidian templates and use</a>
        </li>
      
    </ul>
<!-- photoswipe -->
<script type="module">
	import PhotoSwipeLightbox from '/assets/photoswipe/photoswipe-lightbox.esm.js';
	import PhotoSwipe from '/assets/photoswipe/photoswipe.esm.js';
	
	const lightbox = new PhotoSwipeLightbox({
		gallery: ".photoswipe-gallery",
		children: "a.photoswipe-item",
		showHideAnimationType: 'none',
		pswpModule: PhotoSwipe,
	});

	lightbox.init();
</script>

      </heading-anchors>
    </main>
    <footer>
      <p>
        <em>built with <a href="https://www.11ty.dev/">Eleventy v3.0.0</a></em>
      </p>
    </footer>
    <!-- This page `/blog/2025-05-18 - custom emoji shortcodes in 11ty with a plugin/` was built on 2025-05-23T01:33:47.711Z -->
    
    <script>
			function toggleTheme() {
				const themeCheckbox = document.getElementById("theme-toggle-checkbox");
				const newTheme = themeCheckbox.checked ? "dark" : "light";
				document.documentElement.setAttribute('data-theme', newTheme);
				localStorage.setItem('theme', newTheme);
			}
    </script>
  

</body></html>