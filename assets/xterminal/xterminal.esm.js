/**
 *  XTerminal - v2.1.12
 *  @author Henry Hale
 *  @license MIT
 *  @url https://github.com/henryhale/xterminal#readme
 */
class t{#t;isDisposed;constructor(){this.isDisposed=!1,this.#t=[]}register(t){this.isDisposed?t?.dispose():this.#t.push(t)}dispose(){this.isDisposed||(this.isDisposed=!0,this.#t.forEach((t=>t?.dispose())))}}class e extends t{#e;constructor(){super(),this.#e={stack:[],store:new Map},this.register({dispose:()=>this.#e.store.clear()})}on(t,e){const s=this.#e.store;s.has(t)?s.get(t)?.add(e):s.set(t,new Set([e]))}once(t,e){const s=(...i)=>{e.call(void 0,...i),this.off(t,s)},i=this.#e.store;i.has(t)?i.get(t)?.add(s):i.set(t,new Set([s]))}off(t,e){const s=this.#e.store.get(t);if(s)for(const t of s)if(t===e){s.delete(e);break}}emit(t,...e){if(this.isDisposed)return;const s=this.#e.stack;if(s.includes(t))return;const i=this.#e.store.get(t);if(i){s.push(t);for(const t of i)t.call(void 0,...e);s.pop()}}}const s=Array.isArray;function i(t){return"object"==typeof t&&null!==t}function r(t){return"function"==typeof t}class o{store;ptr;constructor(t=[]){this.store=s(t)?t:[],this.ptr=-1}get size(){return this.store.length}get list(){return[].slice.call(this.store).reverse()}add(t){t&&t!==this.store[0]&&this.store.unshift(t),this.ptr=-1}get previous(){return this.ptr++,this.ptr>=this.size&&(this.ptr=this.size-1),this.store[this.ptr]||""}get next(){return this.ptr--,this.ptr<=-1&&(this.ptr=-1),this.store[this.ptr]||""}clear(){this.store.splice(0)}}const n="&nbsp;",a="xt",u="xt-inactive",l="xt-cursor",c="xt-stdout",h="xt-stdin";function p(t){t&&t.scrollTo(0,t.scrollHeight)}function d(t,e){const r=document.createElement(t);return i(e)?(e?.id&&(r.id=e.id||""),e?.class&&(r.className=e.class||""),e?.content&&r.appendChild(document.createTextNode(""+e.content)),e?.html&&(r.innerHTML=e.html),s(e?.children)&&e.children.forEach((t=>r.append(t))),i(e?.props)&&Object.entries(e.props).forEach((t=>r.setAttribute(t[0],t[1]))),r):r}function f(t=""){return(""+t).replace(/(\n)|(\n\r)|(\r\n)/g,"<br/>").replace(/\s{2}/g,n.repeat(2)).replace(/\t/g,n.repeat(4))}class v{el;console;lastOutput;onoutput;constructor(t){const{outputBox:e,consoleBox:s}=function(t){const e=d("span"),s=d("div",{class:c,children:[e]});return t.appendChild(s),{outputBox:s,consoleBox:e}}(t);this.el=e,this.console=s}write(t,e){this.lastOutput=d("span",{html:f(t)}),this.console.appendChild(this.lastOutput),r(this.onoutput)&&this.onoutput(),r(e)&&e()}clear(){this.console&&(this.console.innerHTML="")}clearLast(){this.lastOutput&&this.lastOutput.parentNode?.removeChild(this.lastOutput),this.lastOutput=void 0}}const g="Enter";function m(t,e,s,i){t.addEventListener(e,s,i);let r=!1;return{dispose(){r||(t.removeEventListener(e,s,i),r=!0)}}}const y=0;function w(t,...e){return setTimeout(t,y,...e)}function b(t){let e;return(...s)=>{r(t)&&(clearTimeout(e),e=w(t,...s))}}let k;function x(t){const e=new Set;let s=!1;return{get value(){return!s&&r(k)&&e.add(k),t},set value(i){t=i,s||e.forEach((t=>t.call(void 0)))},dispose(){s||(s=!0,e.clear())}}}function L(t){if(r(t)){k=t;try{t.call(void 0)}finally{k=null}}}class M extends t{el;buffer;data;ptr;isActive;showInput;isFocused;onkeypress;constructor(t){super(),this.el=function(t){const e=d("input",{props:{spellcheck:!1,autocapitalize:"off",autocomplete:"off"}}),s=d("div",{class:h,children:[e]});return t.appendChild(s),e}(t),this.buffer="",this.data=x(""),this.ptr=x(0),this.isActive=x(!0),this.showInput=x(!0),this.isFocused=x(!1),this.register(this.data),this.register(this.ptr),this.register(this.isActive),this.register(this.showInput),this.register(this.isFocused);const e=()=>function(t,e,s){let i="selectionStart"in(r=t)?r.selectionStart:0;var r;const o=e.value.length;i>o?i=o:i<0&&(i=0),s.value=i}(this.el,this.data,this.ptr),s=b(e),i=b((()=>{this.data.value=this.buffer=this.el.value}));L(e),this.register(m(this.el,"blur",(()=>this.isFocused.value=!1))),this.register(m(this.el,"focus",(()=>this.isFocused.value=!0),!1)),this.register(m(this.el,"keyup",(()=>this.isActive.value&&s()),!1)),this.register(m(this.el,"input",(()=>{i(),s()}))),this.register(m(this.el,"keydown",(t=>{t.stopImmediatePropagation();const e=this.data.value;t.key===g&&(this.el&&(this.el.value=""),this.data.value="",this.buffer="",this.showInput.value=!0),this.isActive.value&&r(this.onkeypress)&&(this.onkeypress({key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,value:e,cancel(){t.preventDefault(),t.stopPropagation()}}),s())})))}blur(){this.el&&this.el.blur()}focus(){this.el&&this.el.focus()}pause(){this.isActive.value=!1}resume(){this.isActive.value=!0}setValue(t){t=t||this.buffer,this.el&&(this.el.value=t),this.data.value=t}pipe(t){const e=d("span"),s=d("span",{class:l,html:n}),i=d("span");t.el?.append(e,s,i),L((()=>{const t=this.ptr.value,r=this.data.value;if(!this.isActive.value||!this.showInput.value)return e.innerHTML="",s.innerHTML=n,void(i.innerHTML="");e.innerHTML=r.substring(0,t).replace(/\s{2}/g," "+n),s.innerHTML=r.substring(t,t+1).trim()||n,i.innerHTML=r.substring(t+1).replace(/\s{2}/g," "+n)}))}}function T(t,e){const s=d("div",{class:a,props:{tabindex:0}}),i=new o,n=new v(s),l=new M(s),c={input:l,output:n,history:i,completer:t=>t};return l.pipe(n),n.onoutput=()=>p(s),t.register(m(s,"keydown",(function(t){l.focus(),w((()=>{l.el.dispatchEvent(new KeyboardEvent("keydown",t)),l.el.dispatchEvent(new KeyboardEvent("input",t))}))}))),t.register(m(s,"focus",(()=>l.isFocused.value=!0))),t.register(m(s,"blur",(()=>l.isFocused.value=!1))),function(){const t=window||{},e=navigator||{};return!(!("ontouchstart"in t)&&!e.maxTouchPoints||!/Mobi/.test(e.userAgent))}()&&t.register(m(s,"click",l.focus.bind(l))),e.appendChild(s),l.onkeypress=e=>{e.key==g?(e.cancel(),i.add(e.value),t.writeln(e.value),t.emit("data",e.value)):"Tab"==e.key?(e.cancel(),r(c.completer)&&l.setValue(c.completer(e.value))):"ArrowDown"==e.key?(e.cancel(),l.setValue(i.next)):"ArrowUp"==e.key?(e.cancel(),l.setValue(i.previous)):t.emit("keypress",e),p(s)},L((()=>{l.isFocused.value?s.classList.remove(u):s.classList.add(u)})),c}class E extends Error{constructor(t){super(t="[x] "+t),this.name="XTerminalError"}}class A extends e{#e;isMounted;constructor(t){super(),this.isMounted=!1,t&&t?.target&&this.mount(t.target)}focus(){this.#e.input.focus()}blur(){this.#e.input.blur()}pause(){this.#e.input.pause(),this.emit("pause")}resume(){this.#e.input.resume(),this.emit("resume")}write(t,e){this.#e.output.write(""+t,e)}writeln(t,e){this.#e.output.write(t+"\n",e)}clear(){this.#e.output.clear(),this.emit("clear")}clearLast(){this.#e.output.clearLast()}get history(){return this.#e.history.list||[]}set history(t){t.forEach((t=>this.#e.history.add(t)))}clearHistory(){this.#e.history.clear()}setCompleter(t){r(t)&&(this.#e.completer=t)}mount(t){if(!this.isMounted){if(t&&"string"==typeof t&&(t=document.querySelector(t)),!(t instanceof HTMLElement))throw new E("mount: A parent HTMLElement (target) is required");!t.isConnected&&console&&console.warn("'mount' was called on an HTMLElement (target) that is not attached to DOM."),t.innerHTML="",this.#e=T(this,t),this.isMounted=!0}}dispose(){super.dispose();const t=this.#e;t.history.clear(),t.completer=void 0,t.input.dispose();const e=t.output.el.parentNode;e?.parentNode?.removeChild(e)}static get version(){return"2.1.12"}}export{A as default};
